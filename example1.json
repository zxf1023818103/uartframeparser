{
    "$schema": "./frame.json",
    "definitions": [
        {
            "name": "status_report",
            "fields": [
                {
                    "bytes": 2,
                    "name": "sof",
                    "default": "return '\\x55\\xaa'",
                    "description": "帧头"
                },
                {
                    "bytes": 1,
                    "name": "length",
                    "description": "长度"
                },
                {
                    "bytes": "return byte(3) - 4",
                    "name": "subframe",
                    "frames": ["subframe1", "subframe2"]
                },
                {
                    "bytes": 1,
                    "name": "checksum"
                }
            ],
            "validator": "return byte(1) == 0x55 and byte(2) == 0xaa and byte(byte(3)) == (sum(1, byte(3) - 1) & 0xff)"
        },
        {
            "name": "subframe1",
            "description": "子帧格式1",
            "fields": [
                {
                    "bytes": 1,
                    "name": "sof",
                    "description": "帧头",
                    "default": "return '\\x01'"
                },
                {
                    "bytes": 1,
                    "name": "working_status",
                    "description": "工作状态"
                }
            ],
            "validator": "return byte(1) == 0x01"
        },
        {
            "name": "subframe2",
            "description": "子帧格式2",
            "fields": [
                {
                    "bytes": 1,
                    "name": "sof",
                    "description": "帧头",
                    "default": "return '\\x02'"
                },
                {
                    "bytes": 1,
                    "name": "fan_status",
                    "description": "风机状态"
                }
            ],
            "validator": "return byte(1) == 0x02"
        }
    ],
    "frames": [
        "status_report"
    ],
    "init": "function sum(from, to) result = 0; for i = from, to, 1 do result = result + byte(i) end; return result; end"
}